--------------------------------------------------------------------------------
	 ██████╗██╗   ██╗██████╗ ███████╗██████╗  ██████╗ ██████╗ ███████╗
	██╔════╝╚██╗ ██╔╝██╔══██╗██╔════╝██╔══██╗██╔═══██╗██╔══██╗██╔════╝
	██║      ╚████╔╝ ██████╔╝█████╗  ██████╔╝██║   ██║██████╔╝███████╗
	██║       ╚██╔╝  ██╔══██╗██╔══╝  ██╔══██╗██║   ██║██╔═══╝ ╚════██║
	╚██████╗   ██║   ██████╔╝███████╗██║  ██║╚██████╔╝██║     ███████║
	 ╚═════╝   ╚═╝   ╚═════╝ ╚══════╝╚═╝  ╚═╝ ╚═════╝ ╚═╝     ╚══════╝

------------------ Análisis, detección y respuesta de Malware ------------------                                                                  

## # # # # # # # # # #  # # # # # # # # # # # # # # # # # # # # # # # # # # # ##  
# >EDGAR SALAZAR <edgar.salazar@guayoyo.io>                            		#
# >JOSMELL CHAVARRI <josmell.chavarri@guayoyo.io>                     		#
# --------------------------     GUAYOYO    --------------------------------- ##
################################################################################

POC 07 - Bloqueando ataques SSH 

En el manager:

Abrir el archivo ossec.conf del servidor manager 
vi /var/ossec/etc/ossec.conf


Copiar la siguiente regla de AR

<active-response>
    <command>host-deny</command>
    <location>local</location>
    <rules_id>5503,5712,5710</rules_id>
    <timeout>300</timeout>
</active-response>


Reiniciar el servicio de wazuh  manager 
systemctl restart wazuh-manager


Verificar Dashboard 
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::


POC 08 - Respuesta activa de archivos maliciosos usando CDB list


Descargar el script  en el directorio /home/Lab3/

cd /home/Lab3/   

curl -LO https://github.com/GuayoyoCyber/CyberOps-Malware-Training/blob/main/lab4/remove-threat.py -o remove-threat.py


Copiar el archivo descragado al directorio bin 

cp remove-threat.py /var/ossec/active-response/bin/remove-threat


Cambiar el propietario del grupo y del archivo a root:wazuh, luego otorgar los permisos de ejecución del script.

chmod 750 /var/ossec/active-response/bin/remove-threat
chmod 750 /var/ossec/active-response/bin/remove-threat.py

chown root:wazuh /var/ossec/active-response/bin/remove-threat    
chown root:wazuh /var/ossec/active-response/bin/remove-threat.py   



Abrir el archivo ossec.conf del servidor manager 
vi /var/ossec/etc/ossec.conf


Activar la respuesta activa cuando se activa la regla de detección de lista negra de malware (en el manager)
Pegar la siguiente configuraci[on en el ossec.conf dentro del bloque ossec_config 


<command>
   <name>remove-threat</name>
   <executable>remove-threat.py</executable>
   <timeout_allowed>no</timeout_allowed>
</command>

<active-response>
   <disabled>no</disabled>
   <command>remove-threat</command>
   <location>local</location>
   <rules_id>100002</rules_id>
</active-response>


Reiniciar el servicio de wazuh  manager 
systemctl restart wazuh-manager


Descargar nuevamente un archivo malicioso en el directorio monitoreado (agente)

# curl -LO http://www.eicar.org/download/eicar.com -o eicar.com


Verificar dashboard

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::.



